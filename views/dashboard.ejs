<%- include('partials/_header'); %>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Dashboard</h1>
        <button id="logout-btn" class="btn btn-danger">Logout</button>
    </div>

    <h2>Registered Devices</h2>
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th scope="col">Device Name</th>
                <th scope="col">Platform</th>
                <th scope="col">Last Seen</th>
                <th scope="col">IP Address</th>
                <th scope="col">Storage (Free/Total)</th>
                <th scope="col">RAM (Free/Total)</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            <% if(devices && devices.length > 0) { %>
                <% devices.forEach(device => { %>
                    <tr>
                        <td><%= device.deviceName %></td>
                        <td><%= device.platform %></td>
                        <td><%= new Date(device.lastSeen).toLocaleString() %></td>
                        <td><%= device.ipAddress %></td>
                        <td><%= device.storage.free %>GB / <%= device.storage.total %>GB</td>
                        <td><%= device.ram.free %>GB / <%= device.ram.total %>GB</td>
                        <td>
                            <a href="/device/<%= device._id %>" class="btn btn-primary btn-sm">Manage</a>
                        </td>
                    </tr>
                <% }); %>
            <% } else { %>
                <tr>
                    <td colspan="7" class="text-center">No devices found.</td>
                </tr>
            <% } %>
        </tbody>
    </table>
</div>

<script>
    document.getElementById('logout-btn').addEventListener('click', () => {
        document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        window.location.href = '/';
    });
</script>

<%- include('partials/_footer'); %>
